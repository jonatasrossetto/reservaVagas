<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Reserva de Vaga</title>
</head>

<body>
    <div id="menu_superior">
        <h1>Reserva de Vagas</h1>
        <button id="tela_cadastro" class="botao_grande">Cadastro</button>
        <button id="tela_relatorio" class="botao_grande">Relatórios</button>
        <h4 id="quantidade_vagas_disponiveis"></h4>
    </div>

    <div id="cadastro_reserva" style="display:block;">
        <h3>Cadastro de Reserva de Vagas</h3>
        <div id="formulario_cadastro_reserva">
            <label> Placa do Veículo <br></label>
            <input type="text" id="placa_veiculo" /><br>
            <label> Nome do proprietário <br></label>
            <input type="text" id="nome_proprietario" /><br>
            <label> Número do apartamento <br></label>
            <input type="text" id="numero_apartamento" /><br>
            <label> Modelo do veículo <br></label>
            <input type="text" id="modelo_veiculo" /><br>
            <label> Cor do veículo <br></label>
            <input type="text" id="cor_veiculo" /><br>
            <label> Número da vaga <br></label>
            <input list="vagas_disponiveis" id="vaga_escolhida" /><br><br>
            <button id="botao_cadastrar" class="botao_grande">Cadastrar</button><br><br>
        </div>
        <datalist id="vagas_disponiveis">
        </datalist>
    </div>

    <div id="relatorios" style="display: none;">
        <h3>Relatório de vagas ocupadas</h3>

        <table id="tabela_relatorio_vagas">
            <tr>
                <th>Vaga</th>
                <th>Proprietário</th>
                <th>Apartamento</th>
                <th>Placa</th>
                <th>ações</th>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
    </div>


</body>


<script>
    const telaCadastro = document.getElementById('tela_cadastro');
    const telaRelatorio = document.getElementById('tela_relatorio');
    const quantidadeVagasDisponiveis = document.getElementById('quantidade_vagas_disponiveis');
    const placaVeiculo = document.getElementById('placa_veiculo');
    const nomeProprietario = document.getElementById('nome_proprietario');
    const numeroApartamento = document.getElementById('numero_apartamento');
    const modeloVeiculo = document.getElementById('modelo_veiculo');
    const corVeiculo = document.getElementById('cor_veiculo');
    const botaoCadastrar = document.getElementById('botao_cadastrar');
    const vagaEscolhida = document.getElementById('vaga_escolhida');

    class DadosReserva {
        constructor(placa, proprietario, apartamento, modelo, cor, numeroVaga) {
            // if (!placa || !proprietario || !apartamento || !modelo || !cor || !numeroVaga) {
            //     alert('Dados inválidos');
            //     throw new Error('Dados inválidos');
            // }
            this.placa = placa;
            this.proprietario = proprietario;
            this.apartamento = apartamento;
            this.modelo = modelo;
            this.cor = cor;
            this.vaga = Number.parseInt(numeroVaga);
        }

        toString() {
            return `placa: ${this.placa}\nproprietario: ${this.proprietario}\napartamento: ${this.apartamento}\nmodelo: ${this.modelo}\ncor: ${this.cor}\nvaga: ${this.vaga}`;
        }
    }


    class Vagas {
        _statusDaVaga = [];
        _vagasReservadas = [];

        constructor(quantidadeVagas) {
            if (isNaN(quantidadeVagas) || quantidadeVagas < 1) {
                throw new Error('Quantidade de vagas inválida');
            }
            for (let i = 0; i < quantidadeVagas; i++) {
                this._statusDaVaga.push(false);
            }
        }

        estaDisponivel(numeroVaga) {
            return !this._statusDaVaga[numeroVaga];
        }

        reservarVaga(dadosReserva) {
            if (this.estaDisponivel(dadosReserva.vaga)) {
                this._statusDaVaga[dadosReserva.vaga] = true;
                this._vagasReservadas.push(dadosReserva);
                return true;
            }
            return false;
        }

        listaVagasDisponiveis() {
            let vagasDisponiveis = [];
            for (let i = 0; i < this._statusDaVaga.length; i++) {
                if (!this._statusDaVaga[i]) {
                    vagasDisponiveis.push(i);
                }
            }
            return vagasDisponiveis;
        }

        listaDeVagasReservadas() {

            return this._vagasReservadas.sort((a, b) => a.vaga - b.vaga);
        }

        apagarReserva(indice) {
            console.log('apagando reserva:' + indice);
            this._statusDaVaga[this._vagasReservadas[indice].vaga] = false;
            this._vagasReservadas.splice(indice, 1);
            console.log(this.listaDeVagasReservadas());
        }

    }

    let vagas = new Vagas(10);
    vagas.reservarVaga(new DadosReserva('ABC-1234', 'João', '101', 'Fiat Uno', 'Preto', 3));
    vagas.reservarVaga(new DadosReserva('BBB-1234', 'Maria', '202', 'Hb20', 'Preto', 7));
    atualizarVagasDisponiveis(vagas);
    atualizarQuantidadeVagasDisponiveis(vagas);

    botao_cadastrar.addEventListener('click', () => {
        console.log('clicou em botao_cadastrar');
        let dado = new DadosReserva(placaVeiculo.value, nomeProprietario.value, numeroApartamento.value, modeloVeiculo.value, corVeiculo.value, vagaEscolhida.value);
        let reservaRealizada = vagas.reservarVaga(dado);
        // console.log(vagas.listaVagasDisponiveis());
        if (reservaRealizada) {
            alert('Reserva realizada com sucesso');
            atualizarVagasDisponiveis(vagas);
            limparFormulario();
            atualizarRelatorioVagas(vagas);
            atualizarQuantidadeVagasDisponiveis(vagas);
            console.log(dado.toString());
        } else {
            alert('Vaga já reservada');
        }

    });

    function atualizarVagasDisponiveis(vagas) {
        const htmlVagasDisponiveis = document.getElementById('vagas_disponiveis');
        const listaDeVagasDisponiveis = vagas.listaVagasDisponiveis();
        htmlVagasDisponiveis.innerHTML = '';
        listaDeVagasDisponiveis.forEach(element => {
            htmlVagasDisponiveis.innerHTML += '<option value="' + element + '"></option>';
        });
    }

    function limparFormulario() {
        placaVeiculo.value = '';
        nomeProprietario.value = '';
        numeroApartamento.value = '';
        modeloVeiculo.value = '';
        corVeiculo.value = '';
        vagaEscolhida.value = '';
    }

    function apagarReserva(indice) {
        vagas.apagarReserva(indice);
        atualizarQuantidadeVagasDisponiveis(vagas);
        atualizarVagasDisponiveis(vagas);
        limparFormulario();
        atualizarRelatorioVagas(vagas);
    }

    function atualizarRelatorioVagas(vagas) {
        const htmlTabelaRelatorioVagas = document.getElementById('tabela_relatorio_vagas');
        htmlTabelaRelatorioVagas.innerHTML = '';
        htmlTabelaRelatorioVagas.innerHTML += '<tr><th>Vaga</th><th>Proprietário</th><th>Apartamento</th><th>Placa</th><th>Ação</th></tr>';
        let vagasReservadas = vagas.listaDeVagasReservadas();
        vagasReservadas.forEach((element, index) => {
            htmlTabelaRelatorioVagas.innerHTML += '<tr><td>' + element.vaga + '</td><td>' + element.proprietario + '</td><td>' + element.apartamento + '</td><td>' + element.placa + '</td><td> <button onclick="apagarReserva(' + index + ');" class="botao_pequeno">apagar</button></td></tr>';
        });
    }

    function atualizarQuantidadeVagasDisponiveis(vagas) {
        quantidadeVagasDisponiveis.innerHTML = 'Quantidade de vagas disponíveis: ' + vagas.listaVagasDisponiveis().length;
    }

    telaCadastro.addEventListener('click', () => {
        console.log('clicou em tela_cadastro');
        atualizarQuantidadeVagasDisponiveis(vagas);
        limparFormulario();
        document.getElementById('cadastro_reserva').style.display = 'block';
        document.getElementById('relatorios').style.display = 'none';
    });

    telaRelatorio.addEventListener('click', () => {
        console.log('clicou em tela_relatorio');
        atualizarQuantidadeVagasDisponiveis(vagas);
        document.getElementById('cadastro_reserva').style.display = 'none';
        document.getElementById('relatorios').style.display = 'block';
        atualizarRelatorioVagas(vagas);
        limparFormulario();
    });



</script>

</html>